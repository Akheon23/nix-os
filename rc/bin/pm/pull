#!/bin/rc

rfork en

if (~ $#PKGROOT 0) {
	PKGROOT=/
}

if (~ $#ROOT 0) {
	ROOT=/
}

if (~ $#PKGSERVER 0) {
	PKGSERVER=jfloren.net
}

fn fail {
	echo $* >[1=2]
	exit fail
}

if (~ $#* 0) {
	fail Need at least one package name
}

cd $PKGROOT^/contrib/packages || exit 'dir not found'
names=()
for(name in $*) {
	if(~ $name */*){
		names=($names $name)
	}
	if not {
		names=($names $name/*)
	}
}
for (PKGNAME in $names) {
	@{	
		# Go to the directory if it exists
		cd $PKGROOT^/contrib/packages/^$PKGNAME || fail $PKGNAME: No such package in $PKGROOT^/contrib/packages
		
		echo -n Fetching root.tgz...
		hget -o root.tgz http://^$PKGSERVER^/contrib/packages/^$PKGNAME^/root.tgz || fail hget failed
		echo Done.
	}
}
exit ''
